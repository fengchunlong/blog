"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[6110],{5861:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>u,frontMatter:()=>l,metadata:()=>i,toc:()=>a});var s=r(5893),t=r(1151);const l={},o="\u6536\u85cf\u529f\u80fd\u5b9e\u73b0",i={id:"Flask\u9879\u76ee:\u7f51\u6613\u4e91\u8bfe\u5802\u8bfe\u7a0b\u5206\u6790/\u6536\u85cf\u529f\u80fd\u5b9e\u73b0",title:"\u6536\u85cf\u529f\u80fd\u5b9e\u73b0",description:"\u6536\u85cf\u529f\u80fd\u5b9e\u73b0\u2014\u591a\u5bf9\u591a\u5173\u7cfb\u6a21\u578b",source:"@site/docs/Flask\u9879\u76ee:\u7f51\u6613\u4e91\u8bfe\u5802\u8bfe\u7a0b\u5206\u6790/11.\u6536\u85cf\u529f\u80fd\u5b9e\u73b0.md",sourceDirName:"Flask\u9879\u76ee:\u7f51\u6613\u4e91\u8bfe\u5802\u8bfe\u7a0b\u5206\u6790",slug:"/Flask\u9879\u76ee:\u7f51\u6613\u4e91\u8bfe\u5802\u8bfe\u7a0b\u5206\u6790/\u6536\u85cf\u529f\u80fd\u5b9e\u73b0",permalink:"/docs/Flask\u9879\u76ee:\u7f51\u6613\u4e91\u8bfe\u5802\u8bfe\u7a0b\u5206\u6790/\u6536\u85cf\u529f\u80fd\u5b9e\u73b0",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/Flask\u9879\u76ee:\u7f51\u6613\u4e91\u8bfe\u5802\u8bfe\u7a0b\u5206\u6790/11.\u6536\u85cf\u529f\u80fd\u5b9e\u73b0.md",tags:[],version:"current",sidebarPosition:11,frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"\u521b\u5efa\u7528\u6237",permalink:"/docs/Flask\u9879\u76ee:\u7f51\u6613\u4e91\u8bfe\u5802\u8bfe\u7a0b\u5206\u6790/\u7528\u6237\u6a21\u5757"},next:{title:"\u5b9e\u73b0404\u9875\u9762",permalink:"/docs/Flask\u9879\u76ee:\u7f51\u6613\u4e91\u8bfe\u5802\u8bfe\u7a0b\u5206\u6790/\u5b9e\u73b0404\u9875\u9762"}},c={},a=[{value:"\u6536\u85cf\u529f\u80fd\u5b9e\u73b0\u2014\u591a\u5bf9\u591a\u5173\u7cfb\u6a21\u578b",id:"\u6536\u85cf\u529f\u80fd\u5b9e\u73b0\u591a\u5bf9\u591a\u5173\u7cfb\u6a21\u578b",level:2},{value:"\u5207\u6362\u6536\u85cf\u4e0e\u53d6\u6d88\u6536\u85cf\u6309\u94ae",id:"\u5207\u6362\u6536\u85cf\u4e0e\u53d6\u6d88\u6536\u85cf\u6309\u94ae",level:2},{value:"Ajax\u5f02\u6b65\u8bf7\u6c42\u5b9e\u73b0\u6536\u85cf\u4e0e\u53d6\u6d88\u6536\u85cf",id:"ajax\u5f02\u6b65\u8bf7\u6c42\u5b9e\u73b0\u6536\u85cf\u4e0e\u53d6\u6d88\u6536\u85cf",level:2},{value:"\u67e5\u770b\u6211\u7684\u6536\u85cf",id:"\u67e5\u770b\u6211\u7684\u6536\u85cf",level:2}];function d(e){const n={code:"code",h1:"h1",h2:"h2",p:"p",pre:"pre",...(0,t.a)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h1,{id:"\u6536\u85cf\u529f\u80fd\u5b9e\u73b0",children:"\u6536\u85cf\u529f\u80fd\u5b9e\u73b0"}),"\n",(0,s.jsx)(n.h2,{id:"\u6536\u85cf\u529f\u80fd\u5b9e\u73b0\u591a\u5bf9\u591a\u5173\u7cfb\u6a21\u578b",children:"\u6536\u85cf\u529f\u80fd\u5b9e\u73b0\u2014\u591a\u5bf9\u591a\u5173\u7cfb\u6a21\u578b"}),"\n",(0,s.jsx)(n.p,{children:"\u6dfb\u52a0\u6a21\u578b\u53ca\u5bf9\u5e94\u5173\u7cfb\uff0c\u4ee3\u7801\u5982\u4e0b\uff1a"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"# models.py\n\nclass User(db.Model,UserMixin):\n    id = db.Column(db.Integer,primary_key=True,autoincrement=True)\n    username = db.Column(db.String(100),nullable=False)\n    email = db.Column(db.String(100),nullable=False,unique=True)\n    password = db.Column(db.String(100),nullable=False)\n    # \u591a\u5bf9\u591a\u5173\u7cfb\n    favorites = db.relationship('Course',secondary='collections',\nbackref=db.backref('user',lazy='dynamic'),\n                                lazy='dynamic')\n    \n   \nclass Course(db.Model):\n    course_id = db.Column(db.String(100),primary_key=True,nullable=False)\n    product_id = db.Column(db.String(100),nullable=False)\n    product_type = db.Column(db.Integer, nullable=False)\n    product_name = db.Column(db.String(125), nullable=False)\n    provider = db.Column(db.String(125), nullable=False)\n    score = db.Column(db.Float(2))\n    score_level = db.Column(db.Integer)\n    learner_count = db.Column(db.Integer)\n    lesson_count = db.Column(db.Integer)\n    lector_name = db.Column(db.String(125))\n    original_price = db.Column(db.Float(2))\n    discount_price = db.Column(db.Float(2))\n    discount_rate = db.Column(db.Float(2))\n    img_url = db.Column(db.String(125))\n    big_img_url = db.Column(db.String(125))\n    description = db.Column(db.Text)\n    \n    \n    \nclass Sale(db.Model):\n    id = db.Column(db.Integer,autoincrement=True,primary_key=True,nullable=False)\n    course_id = db.Column(db.String(100),db.ForeignKey('course.course_id'))\n    product_name = db.Column(db.String(125), nullable=False)\n    learner_count = db.Column(db.Integer)\n    create_time = db.Column(db.Date,default= datetime.today())\n    # \u5173\u8054\u5173\u7cfb\n    course = db.relationship('Course',backref=db.backref('sale',lazy='dynamic'))\n\n\ncollections = db.Table('collections',\n     db.Column('user_id',db.Integer,db.ForeignKey('user.id')),\n     db.Column('course_id',db.String(100),db.ForeignKey('course.course_id'))\n     )\n\n"})}),"\n",(0,s.jsx)(n.p,{children:"\u6267\u884c\u8fc1\u79fb\u547d\u4ee4\uff1a"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"flask db migrate\n\nflask db upgrade\n"})}),"\n",(0,s.jsx)(n.p,{children:"\u5728shell\u4e2d\u6d4b\u8bd5\uff0c\u6267\u884c\u547d\u4ee4\uff1a"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"flask shell\n"})}),"\n",(0,s.jsx)(n.p,{children:"\u8f93\u5165\u5982\u4e0b\u547d\u4ee4"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:">>> from app import db\n>>> from app.models import User, Course\n>>> User.query.all()\n[<User 2>]\n>>> user = User.query.get(2)\n>>> user.username\n'test'\n>>> course1 = Course.query.get('1002781006')\n>>> course2 = Course.query.get('1002781014')\n>>> user.favorites.append(course1)\n\n"})}),"\n",(0,s.jsx)(n.p,{children:"\u6267\u884c\u5b8c\u6210\u540e\uff0c\u6570\u636e\u5e93\u4e2d\u65b0\u589e\u4e00\u4e2acollection\u8868\uff0c\u53ea\u67092\u4e2a\u5b57\u6bb5\uff0cuser_id\u548ccourse_id."}),"\n",(0,s.jsx)(n.p,{children:"\u5728shell\u4e2d\u53ef\u4ee5\u67e5\u770b\u6536\u85cf\u7684\u4fe1\u606f\u3002"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:">>> user.favorites\n<sqlalchemy.orm.dynamic.AppenderQuery object at 0x10ea257d0>\n>>> user.favorites.all()\n[<Course 1002781014>, <Course 1002781006>]\n>>> course1.user\n<sqlalchemy.orm.dynamic.AppenderQuery object at 0x10e8e8910>\n>>> course1.user.first()\n<User 2>\n"})}),"\n",(0,s.jsx)(n.h2,{id:"\u5207\u6362\u6536\u85cf\u4e0e\u53d6\u6d88\u6536\u85cf\u6309\u94ae",children:"\u5207\u6362\u6536\u85cf\u4e0e\u53d6\u6d88\u6536\u85cf\u6309\u94ae"}),"\n",(0,s.jsx)(n.p,{children:"templates/detail.html \u8be6\u60c5\u9875\u4ee3\u7801\u5982\u4e0b\uff1a"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-html",children:'{% extends \'base.html\' %}\n\n{% block content%}\n\n<div class="container">\n    <div class="row" style="margin:20px auto;">\n        <div class="col-sm-6">\n            <img src="{{ course.big_img_url }}" class="card-img-top"\n                 alt="..." width="450px" height="260px">\n        </div>\n        <div class="col-sm-6">\n            <h4>{{ course.product_name }}</h4>\n            <div class="course-info">\u8bfe\u7a0b\u8bb2\u5e08\uff1a{{ course.lector_name }}</div>\n            <div class="course-info">\u6240\u5c5e\u673a\u6784\uff1a{{ course.provider }}</div>\n            <div class="course-info">\u8bfe\u7a0b\u8bc4\u5206\uff1a{{ course.score }}</div>\n            <div class="course-info">\u5b66\u4e60\u4eba\u6570\uff1a{{ course.learner_count}}</div>\n            <div class="course-price">\n                {% if course.discount_price %}\n                    \uffe5{{course.discount_price}}\n                    <span style="color: #666666;font-size: 14px;text-decoration: line-through;">\uffe5{{course.original_price}}</span>\n                {% elif not course.original_price  %}\n                    \u514d\u8d39\n                {% else %}\n                    \uffe5{{course.original_price}}\n                {% endif %}\n            </div>\n            <div>\n                {% if current_user.is_authenticated %}\n                    <button class="btn btn-success" id="collect">\n                        \u6536\u85cf\n                    </button>\n                {% endif %}\n                <a href="https://study.163.com/course/introduction/{{course.course_id}}.htm" target="view_window">\n                    <button type="button" class="btn btn-danger" >\u76f4\u8fbe\u7f51\u6613\u4e91</button>\n                </a>\n            </div>\n        </div>\n    </div>\n\n</div>\n\n<script>\n    $(\'#collect\').click(function(){\n        // \u5f02\u6b65\u52a0\u8f7d\u6570\u636e\n        var url = \'/collect/\' + {{ course.course_id }}\n        that = this\n        $.get(url).done(function (data) {\n            if (data.result == \'error\'){\n                alert(\'\u7cfb\u7edf\u5f02\u5e38\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5\uff01\')\n            }\n            // \u8bf7\u6c42\u6210\u529f\uff0c\u4fee\u6539\u5bf9\u4e8e\u6587\u5b57\n            var text = $(that).text();\n            if (text.trim() == \'\u6536\u85cf\'){\n                $(that).text(\'\u53d6\u6d88\u6536\u85cf\');\n            } else {\n                $(that).text(\'\u6536\u85cf\');\n            }\n        })\n    })\n<\/script>\n\n{% endblock %}\n'})}),"\n",(0,s.jsx)(n.h2,{id:"ajax\u5f02\u6b65\u8bf7\u6c42\u5b9e\u73b0\u6536\u85cf\u4e0e\u53d6\u6d88\u6536\u85cf",children:"Ajax\u5f02\u6b65\u8bf7\u6c42\u5b9e\u73b0\u6536\u85cf\u4e0e\u53d6\u6d88\u6536\u85cf"}),"\n",(0,s.jsx)(n.p,{children:"routes.py\u6587\u4ef6\u4e2d\u6dfb\u52a0collect\u65b9\u6cd5\uff0c\u4ee3\u7801\u662f\u5982\u4e0b\uff1a"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"# routes.py\n\n@app.route('/collect/<course_id>')\n@login_required\ndef collect(course_id):\n    # \u5224\u65ad\u662f\u5426\u6536\u85cf\u8fc7\n    if current_user.is_favorite(course_id):\n        # \u53d6\u6d88\u6536\u85cf\n        if current_user.del_favorite(course_id):\n            data = {'result': 'success'}\n        else:\n            data = {'result': 'error'}\n    else:\n        # \u6dfb\u52a0\u6536\u85cf\n        if current_user.add_favorite(course_id):\n            data = {'result': 'success'}\n        else:\n            data = {'result': 'error'}\n    return json.dumps(data)\n"})}),"\n",(0,s.jsx)(n.p,{children:"\u4e0a\u9762\u7684\u4ee3\u7801\u4e2d\u5305\u542b\u4e863\u4e2a\u65b9\u6cd5is_favorite\uff0c del_favorite\uff0c add_favorite\uff0c \u63a5\u4e0b\u6765\uff0c\u5728models.py\u4e2d\u7684User\u7c7b\u4e2d\u5b9a\u4e49\u8fd93\u4e2a\u65b9\u6cd5\u3002"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"# models.py\n\nclass User(db.Model,UserMixin):\n    id = db.Column(db.Integer,primary_key=True,autoincrement=True)\n    username = db.Column(db.String(100),nullable=False)\n    email = db.Column(db.String(100),nullable=False,unique=True)\n    password = db.Column(db.String(100),nullable=False)\n    # \u591a\u5bf9\u591a\u5173\u7cfb\n    favorites = db.relationship('Course',secondary='collections',\n                                backref=db.backref('user',lazy='dynamic'),\n                                lazy='dynamic')\n\n    # \u5b9a\u4e49\u6536\u85cf\u76f8\u5173\u7684\u65b9\u6cd5\n    def is_favorite(self,course_id):\n        courses = self.favorites.all()\n        course_list =  [course.course_id for course in courses]\n        if course_id in course_list:\n            return True\n\n    def add_favorite(self,course_id):\n        try:\n            course = Course.query.get(course_id)\n            self.favorites.append(course)\n            db.session.commit()\n            return True\n        except:\n            return\n\n\n    def del_favorite(self,course_id):\n        try:\n            course = Course.query.get(course_id)\n            self.favorites.remove(course)\n            db.session.commit()\n            return True\n        except:\n            return\n"})}),"\n",(0,s.jsx)(n.h2,{id:"\u67e5\u770b\u6211\u7684\u6536\u85cf",children:"\u67e5\u770b\u6211\u7684\u6536\u85cf"}),"\n",(0,s.jsx)(n.p,{children:"routes.py\u6587\u4ef6\u4e2d\u521b\u5efafavorites\u8def\u7531\uff0c\u4ee3\u7801\u5982\u4e0b\uff1a"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"@app.route('/favorites')\n@login_required\ndef favorites():\n    page = request.args.get('page',1,type=int)\n    courses = current_user.favorites.paginate(page,per_page=20)\n    return render_template('favorites.html',courses=courses)\n"})}),"\n",(0,s.jsx)(n.p,{children:"templates\u4e0b\u521b\u5efafavorites.html\u6a21\u677f\uff0c\u4ee3\u7801\u5982\u4e0b\uff1a"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-html",children:'{% extends \'base.html\' %}\n{% import \'page.html\' as pg %}\n{% block content %}\n\n<div class="container">\n  {% if courses.total %}\n    <div class="text-monospace" style="margin: 15px 0 0 5px;">\n        \u5171\u6536\u85cf<span class="font-weight-bold">{{ courses.total }}</span>\u95e8\u8bfe\u7a0b\n    </div>\n    <div class="link-top"></div>\n    \x3c!-- \u663e\u793a\u8bfe\u7a0b\u5f00\u59cb --\x3e\n    <div class="row" style="text-align:center;">\n        {% for course in courses.items %}\n        <div class="col-sm-3" style="padding: 20px">\n            <a href="/course/{{course.course_id}}" style="text-decoration: none;color:inherit;">\n                <div class="card" style="height:280px">\n                    <img src="{{course.big_img_url}}" class="card-img-top"\n                         alt="..." height="170px">\n                    <div class="card-body">\n                        <p class="card-title" style="font-weight: bold;">{{course.product_name[0:20]}}</p>\n                        <p class="card-text">\n                            {% if not course.original_price %}\n                                \u514d\u8d39\n                            {% elif course.discount_rate %}\n                                \uffe5{{course.discount_price}}\u5143\n                            {% else %}\n                                \uffe5{{course.original_price}}\u5143\n                            {% endif %}\n                        </p>\n                    </div>\n                </div>\n            </a>\n        </div>\n        {% endfor %}\n    </div>\n        \x3c!-- \u663e\u793a\u8bfe\u7a0b\u7ed3\u675f --\x3e\n\x3c!-- \u5206\u9875\u5f00\u59cb --\x3e\n    {{ pg.page(courses) }}\n\x3c!-- \u5206\u9875\u7ed3\u675f --\x3e\n  {% else%}\n    <div style="text-align:center;">\n        <img src="{{url_for(\'static\',filename=\'images/no_results.png\')}}" width="35%" height="35%">\n        <h4>\u6682\u65e0\u76f8\u5173\u7ed3\u679c</h4>\n        <p>\u6362\u4e2a\u641c\u7d22\u5173\u952e\u8bcd\u8bd5\u8bd5\u5427\uff1a)</p>\n    </div>\n  {% endif %}\n</div>\n<script>\n    $(".page-link").click(function(){\n        var page = $(this).data(\'page\')\n        matchUrl(\'page\',page);  // \u751f\u6210URL\n    })\n<\/script>\n{% endblock %}\n'})})]})}function u(e={}){const{wrapper:n}={...(0,t.a)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},1151:(e,n,r)=>{r.d(n,{Z:()=>i,a:()=>o});var s=r(7294);const t={},l=s.createContext(t);function o(e){const n=s.useContext(l);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:o(e.components),s.createElement(l.Provider,{value:n},e.children)}}}]);